[
  {
    "objectID": "Maps.html",
    "href": "Maps.html",
    "title": "Mapping Sample of New York and Election Work",
    "section": "",
    "text": "Here is an example of an interactive county census map in New York!\n\nknitr::opts_chunk$set(echo = TRUE)\n\nlibrary(tidyverse)\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.0     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.1     ✔ tibble    3.1.8\n✔ lubridate 1.9.2     ✔ tidyr     1.3.0\n✔ purrr     1.0.1     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the \u001b]8;;http://conflicted.r-lib.org/\u0007conflicted package\u001b]8;;\u0007 to force all conflicts to become errors\n\nlibrary(tigris)\n\nTo enable caching of data, set `options(tigris_use_cache = TRUE)`\nin your R script or .Rprofile.\n\nlibrary(sf)\n\nLinking to GEOS 3.8.0, GDAL 3.0.4, PROJ 6.3.1; sf_use_s2() is TRUE\n\nlibrary(tmap)\nlibrary(tmaptools)\nlibrary(htmltools)\nlibrary(janitor)\n\n\nAttaching package: 'janitor'\n\nThe following objects are masked from 'package:stats':\n\n    chisq.test, fisher.test\n\nlibrary(rmapshaper)\nlibrary(here)\n\nhere() starts at /cloud/project\n\noptions(tigris_class = \"sf\")\nknitr::opts_chunk$set(echo = TRUE)\n\n\n\n\n\n\nlibrary(tidyverse)\nlibrary(tigris)\nlibrary(sf)\nlibrary(tidycensus)\nlibrary(htmltools)\nlibrary(janitor)\nlibrary(here)\nlibrary(mapview)\nlibrary(leafsync)\nlibrary(leaflet.extras2)\n\nLoading required package: leaflet\n\noptions(tigris_class = \"sf\")\n\n\nInteractive Maps with MapView Package\nA h/t to Sharon Machlis for turning people on to the Mapview package, and her excellent walkthroughs of it.\nFor the data tonight we’ll be using the tidycensus package to pull both census data, as well as geospatial boundaries. Let’s quickly review how we use it.\n\n# uncomment to run, then recomment it out so you don't run it every time\n\n# census_api_key(\"APIKEYCODE\", install=TRUE)\n\n\n#chose variables we want\nmyvars <- c(totalpop = \"B01003_001\",\n            medincome = \"B19013_001\",\n            medage = \"B01002_001\"\n)\n\n\n#pull for NY counties\nny_counties_withgeo <- get_acs(geography = \"county\",\n                       variables = c(myvars),\n                       state = \"NY\",\n                       output = \"wide\",\n                       geometry = TRUE)\n\nGetting data from the 2017-2021 5-year ACS\n\n\nWarning: • You have not set a Census API key. Users without a key are limited to 500\nqueries per day and may experience performance limitations.\nℹ For best results, get a Census API key at\nhttp://api.census.gov/data/key_signup.html and then supply the key to the\n`census_api_key()` function to use it throughout your tidycensus session.\nThis warning is displayed once per session.\n\n\nDownloading feature geometry from the Census website.  To cache shapefiles for use in future sessions, set `options(tigris_use_cache = TRUE)`.\n\n\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |                                                                      |   1%\n  |                                                                            \n  |=                                                                     |   1%\n  |                                                                            \n  |=                                                                     |   2%\n  |                                                                            \n  |==                                                                    |   2%\n  |                                                                            \n  |==                                                                    |   3%\n  |                                                                            \n  |==                                                                    |   4%\n  |                                                                            \n  |===                                                                   |   4%\n  |                                                                            \n  |===                                                                   |   5%\n  |                                                                            \n  |====                                                                  |   5%\n  |                                                                            \n  |====                                                                  |   6%\n  |                                                                            \n  |=====                                                                 |   7%\n  |                                                                            \n  |=====                                                                 |   8%\n  |                                                                            \n  |======                                                                |   8%\n  |                                                                            \n  |======                                                                |   9%\n  |                                                                            \n  |=======                                                               |   9%\n  |                                                                            \n  |=======                                                               |  10%\n  |                                                                            \n  |=======                                                               |  11%\n  |                                                                            \n  |========                                                              |  11%\n  |                                                                            \n  |========                                                              |  12%\n  |                                                                            \n  |=========                                                             |  12%\n  |                                                                            \n  |=========                                                             |  13%\n  |                                                                            \n  |=========                                                             |  14%\n  |                                                                            \n  |==========                                                            |  14%\n  |                                                                            \n  |==========                                                            |  15%\n  |                                                                            \n  |===========                                                           |  15%\n  |                                                                            \n  |===========                                                           |  16%\n  |                                                                            \n  |============                                                          |  16%\n  |                                                                            \n  |============                                                          |  17%\n  |                                                                            \n  |============                                                          |  18%\n  |                                                                            \n  |=============                                                         |  18%\n  |                                                                            \n  |=============                                                         |  19%\n  |                                                                            \n  |==============                                                        |  19%\n  |                                                                            \n  |==============                                                        |  20%\n  |                                                                            \n  |==============                                                        |  21%\n  |                                                                            \n  |===============                                                       |  21%\n  |                                                                            \n  |===============                                                       |  22%\n  |                                                                            \n  |================                                                      |  22%\n  |                                                                            \n  |================                                                      |  23%\n  |                                                                            \n  |=================                                                     |  24%\n  |                                                                            \n  |=================                                                     |  25%\n  |                                                                            \n  |==================                                                    |  25%\n  |                                                                            \n  |==================                                                    |  26%\n  |                                                                            \n  |===================                                                   |  27%\n  |                                                                            \n  |===================                                                   |  28%\n  |                                                                            \n  |====================                                                  |  28%\n  |                                                                            \n  |====================                                                  |  29%\n  |                                                                            \n  |=====================                                                 |  29%\n  |                                                                            \n  |=====================                                                 |  30%\n  |                                                                            \n  |=====================                                                 |  31%\n  |                                                                            \n  |======================                                                |  31%\n  |                                                                            \n  |======================                                                |  32%\n  |                                                                            \n  |=======================                                               |  32%\n  |                                                                            \n  |=======================                                               |  33%\n  |                                                                            \n  |========================                                              |  34%\n  |                                                                            \n  |========================                                              |  35%\n  |                                                                            \n  |=========================                                             |  35%\n  |                                                                            \n  |=========================                                             |  36%\n  |                                                                            \n  |==========================                                            |  36%\n  |                                                                            \n  |==========================                                            |  37%\n  |                                                                            \n  |==========================                                            |  38%\n  |                                                                            \n  |===========================                                           |  38%\n  |                                                                            \n  |===========================                                           |  39%\n  |                                                                            \n  |============================                                          |  40%\n  |                                                                            \n  |============================                                          |  41%\n  |                                                                            \n  |=============================                                         |  41%\n  |                                                                            \n  |=============================                                         |  42%\n  |                                                                            \n  |==============================                                        |  42%\n  |                                                                            \n  |==============================                                        |  43%\n  |                                                                            \n  |===============================                                       |  44%\n  |                                                                            \n  |===============================                                       |  45%\n  |                                                                            \n  |================================                                      |  45%\n  |                                                                            \n  |================================                                      |  46%\n  |                                                                            \n  |=================================                                     |  47%\n  |                                                                            \n  |==================================                                    |  48%\n  |                                                                            \n  |==================================                                    |  49%\n  |                                                                            \n  |===================================                                   |  50%\n  |                                                                            \n  |===================================                                   |  51%\n  |                                                                            \n  |====================================                                  |  51%\n  |                                                                            \n  |====================================                                  |  52%\n  |                                                                            \n  |=====================================                                 |  52%\n  |                                                                            \n  |=====================================                                 |  53%\n  |                                                                            \n  |======================================                                |  54%\n  |                                                                            \n  |======================================                                |  55%\n  |                                                                            \n  |=======================================                               |  55%\n  |                                                                            \n  |=======================================                               |  56%\n  |                                                                            \n  |========================================                              |  57%\n  |                                                                            \n  |========================================                              |  58%\n  |                                                                            \n  |=========================================                             |  58%\n  |                                                                            \n  |=========================================                             |  59%\n  |                                                                            \n  |==========================================                            |  59%\n  |                                                                            \n  |==========================================                            |  60%\n  |                                                                            \n  |==========================================                            |  61%\n  |                                                                            \n  |===========================================                           |  61%\n  |                                                                            \n  |===========================================                           |  62%\n  |                                                                            \n  |============================================                          |  62%\n  |                                                                            \n  |============================================                          |  63%\n  |                                                                            \n  |=============================================                         |  64%\n  |                                                                            \n  |=============================================                         |  65%\n  |                                                                            \n  |==============================================                        |  65%\n  |                                                                            \n  |==============================================                        |  66%\n  |                                                                            \n  |===============================================                       |  67%\n  |                                                                            \n  |===============================================                       |  68%\n  |                                                                            \n  |================================================                      |  68%\n  |                                                                            \n  |================================================                      |  69%\n  |                                                                            \n  |=================================================                     |  69%\n  |                                                                            \n  |=================================================                     |  70%\n  |                                                                            \n  |==================================================                    |  71%\n  |                                                                            \n  |==================================================                    |  72%\n  |                                                                            \n  |===================================================                   |  73%\n  |                                                                            \n  |====================================================                  |  74%\n  |                                                                            \n  |=====================================================                 |  76%\n  |                                                                            \n  |======================================================                |  77%\n  |                                                                            \n  |========================================================              |  80%\n  |                                                                            \n  |==========================================================            |  82%\n  |                                                                            \n  |==========================================================            |  84%\n  |                                                                            \n  |===========================================================           |  84%\n  |                                                                            \n  |===========================================================           |  85%\n  |                                                                            \n  |============================================================          |  85%\n  |                                                                            \n  |============================================================          |  86%\n  |                                                                            \n  |=============================================================         |  87%\n  |                                                                            \n  |=============================================================         |  88%\n  |                                                                            \n  |==============================================================        |  89%\n  |                                                                            \n  |===============================================================       |  89%\n  |                                                                            \n  |===============================================================       |  91%\n  |                                                                            \n  |================================================================      |  91%\n  |                                                                            \n  |================================================================      |  92%\n  |                                                                            \n  |=================================================================     |  93%\n  |                                                                            \n  |===================================================================   |  95%\n  |                                                                            \n  |===================================================================   |  96%\n  |                                                                            \n  |===================================================================== |  99%\n  |                                                                            \n  |======================================================================| 100%\n\nny_counties_withgeo\n\nSimple feature collection with 62 features and 8 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -79.76215 ymin: 40.4961 xmax: -71.85621 ymax: 45.01585\nGeodetic CRS:  NAD83\nFirst 10 features:\n   GEOID                         NAME totalpopE totalpopM medincomeE medincomeM\n1  36017    Chenango County, New York     47407        NA      55690       2603\n2  36119 Westchester County, New York    999723        NA     105387       1643\n3  36025    Delaware County, New York     44644        NA      52757       2293\n4  36115  Washington County, New York     61504        NA      63869       2006\n5  36075      Oswego County, New York    118019        NA      61983       2218\n6  36067    Onondaga County, New York    474621        NA      66012       1000\n7  36113      Warren County, New York     65692        NA      68765       3677\n8  36051  Livingston County, New York     62253        NA      64467       2308\n9  36009 Cattaraugus County, New York     77211        NA      53537       1681\n10 36105    Sullivan County, New York     78230        NA      63393       2692\n   medageE medageM                       geometry\n1     44.7     0.2 MULTIPOLYGON (((-75.88983 4...\n2     41.2     0.2 MULTIPOLYGON (((-73.77278 4...\n3     48.5     0.3 MULTIPOLYGON (((-75.42264 4...\n4     44.4     0.3 MULTIPOLYGON (((-73.63622 4...\n5     40.7     0.4 MULTIPOLYGON (((-76.61693 4...\n6     39.3     0.2 MULTIPOLYGON (((-76.49931 4...\n7     46.8     0.3 MULTIPOLYGON (((-74.21462 4...\n8     41.7     0.5 MULTIPOLYGON (((-78.06075 4...\n9     42.3     0.4 MULTIPOLYGON (((-79.05908 4...\n10    42.3     0.4 MULTIPOLYGON (((-75.14468 4...\n\n\n\n#all counties in the US\nall_counties_withgeo <- get_acs(geography = \"county\",\n                       variables = c(myvars),\n                       output = \"wide\",\n                       geometry = TRUE)\n\nGetting data from the 2017-2021 5-year ACS\n\n\nDownloading feature geometry from the Census website.  To cache shapefiles for use in future sessions, set `options(tigris_use_cache = TRUE)`.\n\nall_counties_withgeo\n\nSimple feature collection with 3221 features and 8 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -179.1489 ymin: 17.88328 xmax: 179.7785 ymax: 71.36516\nGeodetic CRS:  NAD83\nFirst 10 features:\n   GEOID                              NAME totalpopE totalpopM medincomeE\n1  20161              Riley County, Kansas     72602        NA      53296\n2  19159             Ringgold County, Iowa      4739        NA      57700\n3  30009            Carbon County, Montana     10488        NA      63178\n4  16007           Bear Lake County, Idaho      6327        NA      60337\n5  55011         Buffalo County, Wisconsin     13314        NA      61167\n6  31185             York County, Nebraska     14164        NA      66337\n7  08037            Eagle County, Colorado     55693        NA      91338\n8  42129 Westmoreland County, Pennsylvania    355107        NA      64708\n9  40079         Le Flore County, Oklahoma     48436        NA      43049\n10 48053              Burnet County, Texas     48424        NA      65363\n   medincomeM medageE medageM                       geometry\n1        2489    25.5     0.1 MULTIPOLYGON (((-96.96095 3...\n2        5058    44.3     1.0 MULTIPOLYGON (((-94.47167 4...\n3        4261    50.7     0.9 MULTIPOLYGON (((-109.7987 4...\n4        7039    38.9     1.1 MULTIPOLYGON (((-111.6345 4...\n5        2352    46.5     0.5 MULTIPOLYGON (((-92.08384 4...\n6        4128    39.5     1.2 MULTIPOLYGON (((-97.82629 4...\n7        4058    37.8     0.8 MULTIPOLYGON (((-107.1137 3...\n8        1350    47.1     0.2 MULTIPOLYGON (((-79.90487 4...\n9        1869    38.8     0.3 MULTIPOLYGON (((-95.05996 3...\n10       4694    44.7     0.3 MULTIPOLYGON (((-98.45924 3...\n\n\n\n#remove MOE columns - they all end with \"M\"\nny_counties_withgeo <- ny_counties_withgeo %>%\n  select(-ends_with(\"M\"))\n\nny_counties_withgeo\n\nSimple feature collection with 62 features and 5 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -79.76215 ymin: 40.4961 xmax: -71.85621 ymax: 45.01585\nGeodetic CRS:  NAD83\nFirst 10 features:\n   GEOID                         NAME totalpopE medincomeE medageE\n1  36017    Chenango County, New York     47407      55690    44.7\n2  36119 Westchester County, New York    999723     105387    41.2\n3  36025    Delaware County, New York     44644      52757    48.5\n4  36115  Washington County, New York     61504      63869    44.4\n5  36075      Oswego County, New York    118019      61983    40.7\n6  36067    Onondaga County, New York    474621      66012    39.3\n7  36113      Warren County, New York     65692      68765    46.8\n8  36051  Livingston County, New York     62253      64467    41.7\n9  36009 Cattaraugus County, New York     77211      53537    42.3\n10 36105    Sullivan County, New York     78230      63393    42.3\n                         geometry\n1  MULTIPOLYGON (((-75.88983 4...\n2  MULTIPOLYGON (((-73.77278 4...\n3  MULTIPOLYGON (((-75.42264 4...\n4  MULTIPOLYGON (((-73.63622 4...\n5  MULTIPOLYGON (((-76.61693 4...\n6  MULTIPOLYGON (((-76.49931 4...\n7  MULTIPOLYGON (((-74.21462 4...\n8  MULTIPOLYGON (((-78.06075 4...\n9  MULTIPOLYGON (((-79.05908 4...\n10 MULTIPOLYGON (((-75.14468 4...\n\n\n\n#remove that trailing \"E\"\ncolnames(ny_counties_withgeo) <- sub(\"E$\", \"\", colnames(ny_counties_withgeo)) # $ means end of string only\n\nny_counties_withgeo\n\nSimple feature collection with 62 features and 5 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -79.76215 ymin: 40.4961 xmax: -71.85621 ymax: 45.01585\nGeodetic CRS:  NAD83\nFirst 10 features:\n   GEOID                          NAM totalpop medincome medage\n1  36017    Chenango County, New York    47407     55690   44.7\n2  36119 Westchester County, New York   999723    105387   41.2\n3  36025    Delaware County, New York    44644     52757   48.5\n4  36115  Washington County, New York    61504     63869   44.4\n5  36075      Oswego County, New York   118019     61983   40.7\n6  36067    Onondaga County, New York   474621     66012   39.3\n7  36113      Warren County, New York    65692     68765   46.8\n8  36051  Livingston County, New York    62253     64467   41.7\n9  36009 Cattaraugus County, New York    77211     53537   42.3\n10 36105    Sullivan County, New York    78230     63393   42.3\n                         geometry\n1  MULTIPOLYGON (((-75.88983 4...\n2  MULTIPOLYGON (((-73.77278 4...\n3  MULTIPOLYGON (((-75.42264 4...\n4  MULTIPOLYGON (((-73.63622 4...\n5  MULTIPOLYGON (((-76.61693 4...\n6  MULTIPOLYGON (((-76.49931 4...\n7  MULTIPOLYGON (((-74.21462 4...\n8  MULTIPOLYGON (((-78.06075 4...\n9  MULTIPOLYGON (((-79.05908 4...\n10 MULTIPOLYGON (((-75.14468 4...\n\n\nMapping Virginia counties with mapview\n\nmapview(ny_counties_withgeo, zcol = \"medincome\")\n\n\n\n\n\n\nCustomize colors\n\nmapview(ny_counties_withgeo, zcol = \"medincome\", \n         col.regions = RColorBrewer::brewer.pal(9, \"Greens\"), \n         alpha.regions = 1)\n\nWarning: Found less unique colors (9) than unique zcol values (62)! \nInterpolating color vector to match number of zcol values.\n\n\n\n\n\n\n\nThis map’s dark background appeared automatically, because mapview determined the map included a lot of light colors. You can turn off that feature.\n\nmapviewOptions(\"basemaps.color.shuffle\" = FALSE)\n\n\nmapview(ny_counties_withgeo, zcol = \"medincome\", \n         col.regions = RColorBrewer::brewer.pal(9, \"Greens\"), \n         alpha.regions = 1)\n\nWarning: Found less unique colors (9) than unique zcol values (62)! \nInterpolating color vector to match number of zcol values.\n\n\n\n\n\n\n\nTwo maps together\n\nmap_income <- mapview(ny_counties_withgeo, zcol = \"medincome\", \n         col.regions = RColorBrewer::brewer.pal(9, \"Greens\"), \n         alpha.regions = 1)\n\nWarning: Found less unique colors (9) than unique zcol values (62)! \nInterpolating color vector to match number of zcol values.\n\nmap_age <- mapview(ny_counties_withgeo, zcol = \"medage\", \n         col.regions = RColorBrewer::brewer.pal(9, \"Greens\"), \n         alpha.regions = 1)\n\nWarning: Found less unique colors (9) than unique zcol values (51)! \nInterpolating color vector to match number of zcol values.\n\n\n\nsync(map_income, map_age)\n\n\n\n\n\n\n\n\n\n\n\n\n\nSide-by-side slider to compare the two, from the leaflet.extras2 package\n\nmap_income | map_age\n\n\n\n\n\n\nTo turn off legends, hover text, popups\n\nmapview(ny_counties_withgeo, zcol = \"medincome\", \n         col.regions = RColorBrewer::brewer.pal(9, \"Greens\"), \n         alpha.regions = 1,\n         legend = FALSE, \n         label = FALSE, \n         popup = FALSE)\n\nWarning: Found less unique colors (9) than unique zcol values (62)! \nInterpolating color vector to match number of zcol values.\n\n\n\n\n\n\nCustomize labels\n\nmylabel <- glue::glue(\"{ny_counties_withgeo$NAM} {ny_counties_withgeo$medincome}\")\n\n\nmapview(ny_counties_withgeo, zcol = \"medincome\", \n         col.regions = RColorBrewer::brewer.pal(9, \"Greens\"), \n         alpha.regions = 1,\n         label = mylabel)\n\nWarning: Found less unique colors (9) than unique zcol values (62)! \nInterpolating color vector to match number of zcol values.\n\n\n\n\n\n\n\nCustomize popups\n\nmypopup <- glue::glue(\"<strong>{ny_counties_withgeo$NAM}</strong><br />\n                      Total Population: {ny_counties_withgeo$totalpop}<br />\n                      Median Income: {ny_counties_withgeo$medincome}\") %>% \n  lapply(htmltools::HTML)\n\n# mylabel <- glue::glue(\"{all_data$State} {all_data$PctChange10_20}%\") %>%\n#   lapply(htmltools::HTML)\n\n\nhead(mypopup)\n\n[[1]]\n<strong>Chenango County, New York</strong><br />\nTotal Population: 47407<br />\nMedian Income: 55690\n\n[[2]]\n<strong>Westchester County, New York</strong><br />\nTotal Population: 999723<br />\nMedian Income: 105387\n\n[[3]]\n<strong>Delaware County, New York</strong><br />\nTotal Population: 44644<br />\nMedian Income: 52757\n\n[[4]]\n<strong>Washington County, New York</strong><br />\nTotal Population: 61504<br />\nMedian Income: 63869\n\n[[5]]\n<strong>Oswego County, New York</strong><br />\nTotal Population: 118019<br />\nMedian Income: 61983\n\n[[6]]\n<strong>Onondaga County, New York</strong><br />\nTotal Population: 474621<br />\nMedian Income: 66012\n\n\n\nmapview(ny_counties_withgeo, zcol = \"medincome\", \n         col.regions = RColorBrewer::brewer.pal(9, \"Greens\"), \n         alpha.regions = 1,\n         popup = mypopup)\n\nWarning: Found less unique colors (9) than unique zcol values (62)! \nInterpolating color vector to match number of zcol values."
  }
]